import{c as re,r as v,d as p,h as V,an as de,j as ce,$ as me,A as Q,K as F,aj as K,w as fe,_ as B,C as h,N as b,F as i,E as C,M as c,L as _,I as J,B as q,R as z,O as ge,H as A,J as pe,D as T,m as ve,aN as ye,Q as he,ak as Ce}from"./index.4bc2e000.js";import{b as be,a as H}from"./QSelect.3145b9cc.js";import{d as we,a as Se,e as Ve,g as _e,h as Fe,k as Ie,i as M,f as $e,Q as G}from"./QInput.c29dc47a.js";import{u as ke,a as De,b as je}from"./use-file.d99c2a47.js";import{h as qe}from"./format.8e50e5da.js";import{u as W,Q as X}from"./QImg.1162e61f.js";import{Q as Ae}from"./QPage.adad8caf.js";import{j as Y}from"./message.store.4c689bd0.js";import{u as E}from"./image-categories.store.e568e2c8.js";import{Q as Qe}from"./QVirtualScroll.49570707.js";import{Q as Be,a as Ee}from"./QCard.693a642c.js";import{Q as Le}from"./QDialog.adab8df9.js";import{C as Ne}from"./ConfirmDialog.547899bd.js";import"./use-dark.b16beab3.js";import"./QItem.e8ffb52f.js";import"./position-engine.7d36c3af.js";import"./focus-manager.05708ea9.js";import"./use-virtual-scroll.28d516b8.js";import"./settings.store.7f20a04c.js";import"./use-quasar.40b0fec9.js";import"./QList.ed7c7269.js";import"./QCardActions.0794beeb.js";var Ue=re({name:"QFile",inheritAttrs:!1,props:{...we,...Se,...ke,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...Ve,...De],setup(e,{slots:t,emit:d,attrs:r}){const{proxy:f}=ce(),s=_e(),l=v(null),u=v(!1),n=Fe(e),{pickFiles:y,onDragover:w,onDragleave:I,processFiles:S,getDndNode:L}=je({editable:s.editable,dnd:u,getFileInput:O,addFilesToQueue:R}),N=Ie(e),o=p(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),U=p(()=>M(o.value)),Z=p(()=>o.value.map(a=>a.name).join(", ")),x=p(()=>qe(o.value.reduce((a,m)=>a+m.size,0))),ee=p(()=>({totalSize:x.value,filesNumber:o.value.length,maxFiles:e.maxFiles})),te=p(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:n.value,...r,id:s.targetUid.value,disabled:s.editable.value!==!0})),ae=p(()=>"q-file q-field--auto-height"+(u.value===!0?" q-file--dnd":"")),P=p(()=>e.multiple===!0&&e.append===!0);function k(a){const m=o.value.slice();m.splice(a,1),D(m)}function le(a){const m=o.value.indexOf(a);m>-1&&k(m)}function D(a){d("update:modelValue",e.multiple===!0?a:a[0])}function oe(a){a.keyCode===13&&me(a)}function se(a){(a.keyCode===13||a.keyCode===32)&&y(a)}function O(){return l.value}function R(a,m){const g=S(a,m,o.value,P.value),j=O();j!=null&&(j.value=""),g!==void 0&&((e.multiple===!0?e.modelValue&&g.every(ie=>o.value.includes(ie)):e.modelValue===g[0])||D(P.value===!0?o.value.concat(g):g))}function $(){return[V("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function ue(){if(t.file!==void 0)return o.value.length===0?$():o.value.map((m,g)=>t.file({index:g,file:m,ref:this}));if(t.selected!==void 0)return o.value.length===0?$():t.selected({files:o.value,ref:this});if(e.useChips===!0)return o.value.length===0?$():o.value.map((m,g)=>V(be,{key:"file-"+g,removable:s.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{k(g)}},()=>V("span",{class:"ellipsis",textContent:m.name})));const a=e.displayValue!==void 0?e.displayValue:Z.value;return a.length!==0?[V("div",{class:e.inputClass,style:e.inputStyle,textContent:a})]:$()}function ne(){const a={ref:l,...te.value,...N.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:R};return e.multiple===!0&&(a.multiple=!0),V("input",a)}return Object.assign(s,{fieldClass:ae,emitValue:D,hasValue:U,inputRef:l,innerValue:o,floatingLabel:p(()=>U.value===!0||M(e.displayValue)),computedCounter:p(()=>{if(e.counterLabel!==void 0)return e.counterLabel(ee.value);const a=e.maxFiles;return`${o.value.length}${a!==void 0?" / "+a:""} (${x.value})`}),getControlChild:()=>L("file"),getControl:()=>{const a={ref:s.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return s.editable.value===!0&&Object.assign(a,{onDragover:w,onDragleave:I,onKeydown:oe,onKeyup:se}),V("div",a,[ne()].concat(ue()))}}),Object.assign(f,{removeAtIndex:k,removeFile:le,getNativeElement:()=>l.value}),de(f,"nativeEl",()=>l.value),$e(s)}});const xe=Q({name:"ImageCategoryAdd",props:{isShow:{type:Boolean,default:!1}},setup(e,t){const d=E(),r=Y(),{categoriesList:f}=F(d),s=K(()=>e.isShow),l=v("");return fe(s,y=>{y&&(l.value="")}),{categoriesList:f,show:s,name:l,close:()=>{t.emit("close")},save:async()=>{if(l.value===""){r.error("\u0418\u043C\u044F \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438 \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u043F\u0443\u0441\u0442\u044B\u043C!");return}const y=await d.insert({record:{name:l.value}});console.log(y)}}}}),Pe={class:"q-pa-md q-gutter-sm"},Oe={class:"flex justify-between items-center"},Re={class:"q-mt-sm q-pa-sm item",dense:"",clickable:""},ze={class:"flex justify-between items-center"},Te={class:"flex justify-center items-center q-ma-md"};function Me(e,t,d,r,f,s){return h(),b("div",Pe,[i(Le,{modelValue:e.show,"onUpdate:modelValue":t[1]||(t[1]=l=>e.show=l),persistent:""},{default:C(()=>[i(Be,null,{default:C(()=>[i(Ee,null,{default:C(()=>[c("div",Oe,[i(G,{outlined:"",autofocus:"",label:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E",modelValue:e.name,"onUpdate:modelValue":t[0]||(t[0]=l=>e.name=l),style:{padding:"0"}},null,8,["modelValue"]),i(_,{class:"q-ml-md",round:"",color:"primary",label:">",onClick:e.save},null,8,["onClick"])]),i(Qe,{style:{height:"300px"},class:"q-px-md",items:e.categoriesList,separator:""},{default:C(({item:l})=>[c("div",Re,[c("div",ze,[c("div",null,J(l.name),1)])])]),_:1},8,["items"])]),_:1}),c("div",Te,[i(_,{label:"\u041E\u0442\u043C\u0435\u043D\u0430",color:"primary",onClick:e.close},null,8,["onClick"])])]),_:1})]),_:1},8,["modelValue"])])}var Ke=B(xe,[["render",Me],["__scopeId","data-v-18db3cbb"]]);const Je=Q({name:"ImagesList",components:{ConfirmDialog:Ne},props:{category:{type:String,default:()=>""},showControls:{type:Boolean,default:!0},showCategory:{type:Boolean,default:!0}},setup(e){const t=W(),d=E(),{categoryNames:r}=F(d),f=K(()=>e.category),s=v(!1),{imagesByCategory:l}=F(t),u=v(0),n=S=>{u.value=S,s.value=!0},y=async()=>{await t.removeImage(u.value),w()},w=()=>{s.value=!1,u.value=0};return{isShowDialog:s,categoryNames:r,curCategory:f,imagesByCategory:l,confirmDelete:n,removeImage:y,closeDialog:w,update:async S=>{await t.update({record:S})}}}}),He={class:"flex justify-end item-control"},Ge={class:"q-gutter-xs"};function We(e,t,d,r,f,s){const l=q("ConfirmDialog");return h(),b(z,null,[(h(!0),b(z,null,ge(e.imagesByCategory(e.curCategory),u=>(h(),b("div",{class:"full-width",key:u.id},[c("div",{class:pe(["full-width flex justify-between items-center q-my-xs q-pl-sm item",{modified:u.isModified}])},[i(X,{src:u.content,"spinner-color":"white",style:{height:"70px","max-width":"70px"}},null,8,["src"]),A(" "+J(u.name)+" ",1),i(H,{"bottom-slots":"",modelValue:u.category,"onUpdate:modelValue":[n=>u.category=n,n=>e.update(u)],options:e.categoryNames,label:"\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F",outlined:"",style:{padding:"0"}},null,8,["modelValue","onUpdate:modelValue","options"]),c("div",He,[c("div",Ge,[i(_,{size:"12px",flat:"",dense:"",round:"",icon:"save",onClick:n=>e.saveItem(u.id)},null,8,["onClick"]),i(_,{size:"12px",flat:"",dense:"",round:"",icon:"delete",onClick:n=>e.confirmDelete(u.id)},null,8,["onClick"])])])],2)]))),128)),i(l,{isShow:e.isShowDialog,message:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u0443\u044E \u0437\u0430\u043F\u0438\u0441\u044C?",onOk:e.removeImage,onCancel:e.closeDialog},null,8,["isShow","onOk","onCancel"])],64)}var Xe=B(Je,[["render",We],["__scopeId","data-v-dd05c73e"]]);const Ye=Q({name:"ImagesPage",components:{ImageCategoryAdd:Ke,ImagesList:Xe},setup(){const e=v(null),t=v(""),d=v(""),r=v(""),f=v(!1),s=W(),l=E(),{defaultCategory:u,categoryNames:n}=F(l);r.value=u.value.name;const{imagesList:y,placeholderUrl:w}=F(s),I=Y();return s.getImages(),{imagesList:y,image:e,imageUrl:t,name:d,isShowDialog:f,placeholderUrl:w,category:r,categoryNames:n,failed:async o=>{I.error(JSON.parse(o.xhr.responseText).message)},handleUpload:async()=>{if(e.value){const o=await Ze(e.value);t.value=o}},save:async()=>{if(e.value){const o={record:{name:d.value,content:t.value,category:r.value},fileName:e.value.name};await s.insert(o),d.value=""}}}}}),Ze=e=>new Promise(function(t,d){if(!(e instanceof Blob))return d("bufferToImage - expected buf to be of type: Blob");var r=new FileReader;r.onload=function(){return typeof r.result!="string"?d("bufferToImage - expected reader.result to be a string, in onload"):t(r.result)},r.onerror=d,r.readAsDataURL(e)}),et={class:"row justify-between items-start full-width"},tt={class:"row justify-start q-pa-md full-width q-col-gutter-md"},at={class:"col-md-6 col-12"},lt={class:"flex justify-between items-center"},ot={class:"col-md-6 col-12 flex justify-center"},st=["src"],ut={class:"full-width flex justify-center q-px-lg"},nt={key:0},it={key:1,class:"full-width flex justify-start wrap"};function rt(e,t,d,r,f,s){const l=q("ImagesList"),u=q("ImageCategoryAdd");return h(),T(Ae,null,{default:C(()=>[c("div",et,[c("section",tt,[c("div",at,[i(Ue,{class:"full-width",outlined:"","bottom-slots":"",modelValue:e.image,"onUpdate:modelValue":[t[1]||(t[1]=n=>e.image=n),e.handleUpload],counter:"","max-files":"1",label:"\u0412\u044B\u0431\u043E\u0440 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F",accept:".jpg, .jpeg, .png"},{hint:C(()=>[A(" \u0420\u0430\u0437\u043C\u0435\u0440 ")]),append:C(()=>[ve(i(he,{name:"close",onClick:t[0]||(t[0]=Ce(n=>e.image=null,["stop","prevent"])),class:"cursor-pointer"},null,512),[[ye,e.image!==null]])]),_:1},8,["modelValue","onUpdate:modelValue"]),i(G,{outlined:"",class:"q-my-md",label:"\u0418\u043C\u044F",modelValue:e.name,"onUpdate:modelValue":t[2]||(t[2]=n=>e.name=n),style:{padding:"0"}},null,8,["modelValue"]),c("div",lt,[i(H,{style:{width:"85%",padding:"0"},"bottom-slots":"",modelValue:e.category,"onUpdate:modelValue":t[3]||(t[3]=n=>e.category=n),options:e.categoryNames,label:"\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F",outlined:""},null,8,["modelValue","options"]),i(_,{round:"",color:"primary",icon:"add",onClick:t[4]||(t[4]=n=>e.isShowDialog=!0)})]),i(_,{onClick:e.save,class:"q-mt-md",color:"primary",rounded:"",disable:e.image===null||e.name===""},{default:C(()=>[A("\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u0431\u0430\u0437\u0443")]),_:1},8,["onClick","disable"])]),c("div",ot,[e.image?(h(),T(X,{key:1,src:e.imageUrl,"spinner-color":"white",style:{height:"300px","max-width":"300px"},fit:"cover"},null,8,["src"])):(h(),b("img",{key:0,width:"300",src:e.placeholderUrl},null,8,st))])]),c("section",ut,[e.imagesList.length===0?(h(),b("h6",nt,"\u0421\u043F\u0438\u0441\u043E\u043A \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0439 \u043F\u0443\u0441\u0442")):(h(),b("div",it,[i(l,{category:e.category},null,8,["category"])]))])]),i(u,{isShow:e.isShowDialog,onClose:t[5]||(t[5]=n=>e.isShowDialog=!1)},null,8,["isShow"])]),_:1})}var At=B(Ye,[["render",rt]]);export{At as default};
