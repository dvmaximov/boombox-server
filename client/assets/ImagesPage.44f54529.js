import{c as Y,r as y,d,h as b,am as Z,j as ee,X as te,_ as ae,A as le,K as ue,B as ne,C as p,N as C,F as f,E as v,R as P,M as h,H as _,m as ie,aO as se,Q as oe,aj as re,L as q,D as L,O as de,I as ce}from"./index.1b64f866.js";import{Q as me}from"./QChip.ffa464c4.js";import{d as fe,a as ve,e as ge,g as pe,h as he,k as ye,i as U,f as be,Q as Ce}from"./QInput.51679a2f.js";import{u as Fe,a as we,b as Ve}from"./use-file.8a8b51b5.js";import{h as Se}from"./format.3e32b8d9.js";import{u as xe,Q as $}from"./QImg.c44aed45.js";import{Q as De}from"./QCardActions.25625c9a.js";import{Q as Ie}from"./QCard.630a4998.js";import{Q as ke}from"./QPage.efbb4c49.js";import{u as _e}from"./message.store.aa3fd45c.js";import{C as Qe}from"./ConfirmDialog.f9bee6c1.js";import"./use-dark.72e7127e.js";import"./focus-manager.05708ea9.js";import"./use-quasar.e428e5b6.js";import"./QDialog.86d3e7e6.js";import"./use-timeout.fc9efce6.js";var je=Y({name:"QFile",inheritAttrs:!1,props:{...fe,...ve,...Fe,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...ge,...we],setup(e,{slots:a,emit:o,attrs:s}){const{proxy:g}=ee(),u=pe(),c=y(null),n=y(!1),F=he(e),{pickFiles:S,onDragover:x,onDragleave:w,processFiles:Q,getDndNode:j}=Ve({editable:u.editable,dnd:n,getFileInput:N,addFilesToQueue:O}),m=ye(e),l=d(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),B=d(()=>U(l.value)),R=d(()=>l.value.map(t=>t.name).join(", ")),A=d(()=>Se(l.value.reduce((t,i)=>t+i.size,0))),T=d(()=>({totalSize:A.value,filesNumber:l.value.length,maxFiles:e.maxFiles})),z=d(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:F.value,...s,id:u.targetUid.value,disabled:u.editable.value!==!0})),K=d(()=>"q-file q-field--auto-height"+(n.value===!0?" q-file--dnd":"")),E=d(()=>e.multiple===!0&&e.append===!0);function D(t){const i=l.value.slice();i.splice(t,1),I(i)}function M(t){const i=l.value.indexOf(t);i>-1&&D(i)}function I(t){o("update:modelValue",e.multiple===!0?t:t[0])}function H(t){t.keyCode===13&&te(t)}function J(t){(t.keyCode===13||t.keyCode===32)&&S(t)}function N(){return c.value}function O(t,i){const r=Q(t,i,l.value,E.value),k=N();k!=null&&(k.value=""),r!==void 0&&((e.multiple===!0?e.modelValue&&r.every(W=>l.value.includes(W)):e.modelValue===r[0])||I(E.value===!0?l.value.concat(r):r))}function V(){return[b("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function X(){if(a.file!==void 0)return l.value.length===0?V():l.value.map((i,r)=>a.file({index:r,file:i,ref:this}));if(a.selected!==void 0)return l.value.length===0?V():a.selected({files:l.value,ref:this});if(e.useChips===!0)return l.value.length===0?V():l.value.map((i,r)=>b(me,{key:"file-"+r,removable:u.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{D(r)}},()=>b("span",{class:"ellipsis",textContent:i.name})));const t=e.displayValue!==void 0?e.displayValue:R.value;return t.length!==0?[b("div",{class:e.inputClass,style:e.inputStyle,textContent:t})]:V()}function G(){const t={ref:c,...z.value,...m.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:O};return e.multiple===!0&&(t.multiple=!0),b("input",t)}return Object.assign(u,{fieldClass:K,emitValue:I,hasValue:B,inputRef:c,innerValue:l,floatingLabel:d(()=>B.value===!0||U(e.displayValue)),computedCounter:d(()=>{if(e.counterLabel!==void 0)return e.counterLabel(T.value);const t=e.maxFiles;return`${l.value.length}${t!==void 0?" / "+t:""} (${A.value})`}),getControlChild:()=>j("file"),getControl:()=>{const t={ref:u.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return u.editable.value===!0&&Object.assign(t,{onDragover:x,onDragleave:w,onKeydown:H,onKeyup:J}),b("div",t,[G()].concat(X()))}}),Object.assign(g,{removeAtIndex:D,removeFile:M,getNativeElement:()=>c.value}),Z(g,"nativeEl",()=>c.value),be(u)}});const Be=le({name:"ImagesPage",components:{ConfirmDialog:Qe},setup(){const e=y(0),a=y(null),o=y(""),s=y(""),g=y(!1),u=xe(),{imagesList:c}=ue(u),n=_e();u.getImages();const F=async()=>{if(a.value){const m=await Ae(a.value);o.value=m}},S=m=>{e.value=m,g.value=!0},x=async()=>{await u.removeImage(e.value),w()},w=()=>{g.value=!1,e.value=0};return{imagesList:c,image:a,imageUrl:o,name:s,isShowDialog:g,failed:async m=>{n.error(JSON.parse(m.xhr.responseText).message)},confirmDelete:S,removeImage:x,handleUpload:F,save:async()=>{if(a.value){const m={record:{name:s.value,content:o.value},fileName:a.value.name};await u.insert(m),s.value=""}},closeDialog:w}}}),Ae=e=>new Promise(function(a,o){if(!(e instanceof Blob))return o("bufferToImage - expected buf to be of type: Blob");var s=new FileReader;s.onload=function(){return typeof s.result!="string"?o("bufferToImage - expected reader.result to be a string, in onload"):a(s.result)},s.onerror=o,s.readAsDataURL(e)}),Ee={class:"row justify-between items-start full-width"},Ne={class:"row justify-start q-pa-md full-width q-col-gutter-md"},Oe={class:"col-md-6 col-12"},Pe={class:"col-md-6 col-12 flex justify-center"},qe={key:0,width:"300",src:"http://localhost:8880/images/placeholder.jpg"},Le={class:"flex justify-center q-px-lg"},Ue={key:0},$e={key:1,class:"full-width flex justify-start wrap"},Re={class:"absolute-bottom"},Te={style:{"font-size":"8px"}};function ze(e,a,o,s,g,u){const c=ne("ConfirmDialog");return p(),C(P,null,[f(ke,null,{default:v(()=>[h("div",Ee,[h("section",Ne,[h("div",Oe,[f(je,{class:"full-width",outlined:"","bottom-slots":"",modelValue:e.image,"onUpdate:modelValue":[a[1]||(a[1]=n=>e.image=n),e.handleUpload],counter:"","max-files":"1",label:"\u0412\u044B\u0431\u043E\u0440 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F",accept:".jpg, .jpeg, .png"},{hint:v(()=>[_(" \u0420\u0430\u0437\u043C\u0435\u0440 ")]),append:v(()=>[ie(f(oe,{name:"close",onClick:a[0]||(a[0]=re(n=>e.image=null,["stop","prevent"])),class:"cursor-pointer"},null,512),[[se,e.image!==null]])]),_:1},8,["modelValue","onUpdate:modelValue"]),f(Ce,{outlined:"",class:"q-my-md",label:"\u0418\u043C\u044F",modelValue:e.name,"onUpdate:modelValue":a[2]||(a[2]=n=>e.name=n)},null,8,["modelValue"]),f(q,{onClick:e.save,color:"primary",rounded:"",disable:e.image===null||e.name===""},{default:v(()=>[_("\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u0431\u0430\u0437\u0443")]),_:1},8,["onClick","disable"])]),h("div",Pe,[e.image?(p(),L($,{key:1,src:e.imageUrl,"spinner-color":"white",style:{height:"300px","max-width":"300px"},fit:"cover"},null,8,["src"])):(p(),C("img",qe))])]),h("section",Le,[e.imagesList.length===0?(p(),C("h6",Ue,"\u0421\u043F\u0438\u0441\u043E\u043A \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0439 \u043F\u0443\u0441\u0442")):(p(),C("div",$e,[(p(!0),C(P,null,de(e.imagesList,n=>(p(),L(Ie,{key:n.id,class:"q-ma-sm",style:{width:"100px"}},{default:v(()=>[f($,{src:n.content,style:{height:"100px","max-width":"100px"}},{default:v(()=>[h("div",Re,[h("div",Te,ce(n.name),1)])]),_:2},1032,["src"]),f(De,null,{default:v(()=>[f(q,{flat:"",style:{"font-size":"8px"},onClick:F=>e.confirmDelete(n.id)},{default:v(()=>[_("\u0423\u0434\u0430\u043B\u0438\u0442\u044C")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]))])])]),_:1}),f(c,{isShow:e.isShowDialog,message:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u0443\u044E \u0437\u0430\u043F\u0438\u0441\u044C?",onOk:e.removeImage,onCancel:e.closeDialog},null,8,["isShow","onOk","onCancel"])],64)}var st=ae(Be,[["render",ze]]);export{st as default};
