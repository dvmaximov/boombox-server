import{a0 as m,K as p,a1 as a}from"./index.cad163f6.js";import{k as I,j as l}from"./message.store.760a5617.js";const v=I(),D=m("audio",{state:()=>({audioList:[]}),getters:{audioNames:e=>e.audioList.reduce((t,r)=>(t.push(r.name),t),[]),apiUrl:()=>{const e=l();return p(e),`${location.protocol}//${location.hostname}/api/audio/upload`},audioUrl:()=>{const e=l();return p(e),`${location.protocol}//${location.hostname}/audio`}},actions:{async getAudio(){try{const e=await a.fetch("audio");e.error||(this.audioList=e.result||[])}catch{}},async removeAudio(e){if(!await L().checkAudioFree(e)){v.error("\u0423\u0434\u0430\u043B\u0435\u043D\u0438\u0435 \u043D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E! \u0417\u0430\u043F\u0438\u0441\u044C \u0443\u0447\u0430\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0430\u0445");return}try{const s=await a.remove("audio",e);s.error?v.error(s.error):(await this.getAudio(),v.success(s.result))}catch{}},getAudioById(e){try{return this.audioList.find(r=>r.id===e)}catch{}},getAudioByName(e){return this.audioList.find(t=>t.name===e)}}}),d={IMAGE:"\u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435",VIDEO:"\u0432\u0438\u0434\u0435\u043E"},$=m("images",{state:()=>({imagesList:[],loadingContent:!1}),getters:{placeholderUrl:()=>{const e=l();return p(e),`${location.protocol}//${location.hostname}/images/placeholder.jpg`},images:e=>(t,r)=>{let s=[];return r===""?s=e.imagesList.filter(i=>i.category===t):s=e.imagesList.filter(i=>i.name.toLowerCase().includes(r.toLowerCase())),s}},actions:{async getImages(){try{const e=await a.fetch("images");e.error||(this.imagesList=e.result||[])}catch{}},getImageById(e){try{return this.imagesList.find(r=>r.id===e)}catch{}},async getContentById(e){this.loadingContent=!0;let t="";try{const r=await a.fetchById("images",e);r.error||(t=r.result.content)}catch{}return this.loadingContent=!1,t},async removeImage(e){const t=L(),r=P(),s=await t.getProgramsWithImage(),i=[];for(const o of s){const u=await r.getByProgramId(o.id);for(const n of u)n.id&&n.image_id===e&&i.push(n.id)}for(const o of i)await r.removeItem(o);try{(await a.remove("images",e)).error||await this.getImages()}catch{}},async insert(e){try{const t=await a.insert("images",e);t.error||this.imagesList.push({...t.result})}catch{}},async update(e){try{(await a.update("images",e)).error||await this.getImages()}catch{}}}}),k=m("video",{state:()=>({videoList:[],loadingContent:!1}),getters:{apiUrl:()=>{const e=l();return p(e),`${location.protocol}//${location.hostname}/api/video/upload`},videoUrl:()=>{const e=l();return p(e),`${location.protocol}//${location.hostname}/video`},videos:e=>t=>{let r=[];return t===""?r=e.videoList:r=e.videoList.filter(s=>s.name.toLowerCase().includes(t.toLowerCase())),r}},actions:{async getVideos(){try{const e=await a.fetch("video");e.error||(this.videoList=e.result||[])}catch{}},getVideoById(e){try{return this.videoList.find(r=>r.id===e)}catch{}},async getContentById(e){this.loadingContent=!0;const t=this.videoList.find(r=>r.id===e);return this.loadingContent=!1,t},async removeVideo(e){const t=L(),r=P(),s=await t.getProgramsWithVideo(),i=[];for(const o of s){const u=await r.getByProgramId(o.id);for(const n of u)n.id&&n.image_id===e&&i.push(n.id)}for(const o of i)await r.removeItem(o);try{(await a.remove("video",e)).error||await this.getVideos()}catch{}},async insert(e){try{const t=await a.insert("video",e);t.error||this.videoList.push({...t.result})}catch{}},async update(e){try{(await a.update("video",e)).error||await this.getVideos()}catch{}}}}),E=I(),P=m("ProgramsItems",{state:()=>({programItemsList:[]}),getters:{isEmpty:e=>t=>e.programItemsList.filter(s=>s.program_id===t).length===0,emptyProgram:()=>{const e=new Date,t=e.getFullYear(),r=e.getMonth(),s=e.getDay(),i=`${t}/${r}/${s}`;return{program_id:0,image_id:0,startDate:i,endDate:i,active:"true",always:"false"}}},actions:{getItemsByProgramId(e,t,r){const s=$(),i=k();let u=this.programItemsList.filter(n=>n.program_id===e).reduce((n,c)=>{var C,B;const h=c.image_id?c.image_id:0;let g="";t===d.IMAGE?g=(C=s.getImageById(h))==null?void 0:C.name:t===d.VIDEO&&(g=(B=i.getVideoById(h))==null?void 0:B.name);const f=c.active==="true",y=c.always==="true",_={...c,imageName:g,activeBool:f,alwaysBool:y,isModified:!1};return n.push(_),n},[]);return r!==""&&(u=u.filter(n=>n.imageName.toLowerCase().includes(r.toLowerCase()))),u},async getItems(){try{const e=await a.fetch("programs/items");e.error||(this.programItemsList=e.result||[])}catch{}},getItemById(e){try{return this.programItemsList.find(r=>r.id===e)}catch{}},async removeItem(e){if(e!==void 0)try{(await a.remove("programs/items",e)).error||await this.getItems()}catch{}},async getByProgramId(e){return await this.getItems(),this.programItemsList.filter(r=>r.program_id===e)},async removeItemsByProgramId(e){const t=await this.getByProgramId(e);for(const r of t)await this.removeItem(r.id)},async insert(e){try{const t=await a.insert("programs/items",e);return t.error||this.programItemsList.push({...t.result}),t}catch{}},async update(e){try{const t=await a.update("programs/items",e);t.error?E.error(t.error):(await this.getItems(),E.success(t.result))}catch{}}}}),w=I(),L=m("Programs",{state:()=>({programList:[]}),getters:{isEmpty:e=>e.programList.length===0,programs:e=>{const t=A(),r=D();return e.programList.reduce((i,o)=>{var f,y;const u=o.spinner_id?o.spinner_id:0,n=(f=t.getSpinnerById(u))==null?void 0:f.name,c=o.audio_id?o.audio_id:0,h=(y=r.getAudioById(c))==null?void 0:y.name,g={...o,spinnerName:n,audioName:h};return i.push(g),i},[])},emptyProgram:()=>({name:"",audio_id:null,spinner_id:null,startTime:"00:00",endTime:"00:00",imageShowTime:0,program_type:d.IMAGE})},actions:{async getPrograms(){try{const e=await a.fetch("programs");e.error||(this.programList=e.result||[])}catch{}},getProgramById(e){try{return this.programList.find(r=>r.id===e)}catch{}},async getProgramsWithImage(){return await this.getPrograms(),this.programList.filter(t=>t.program_type===d.IMAGE)},async getProgramsWithVideo(){return await this.getPrograms(),this.programList.filter(t=>t.program_type===d.VIDEO)},async removeProgram(e){const t=P();try{t.removeItemsByProgramId(e);const r=await a.remove("programs",e);r.error?w.error(r.error):(await this.getPrograms(),w.success(r.result))}catch{}},async insert(e){try{const t=await a.insert("programs",e);return t.error?w.error(t.error):(this.programList.push({...t.result}),w.success("\u041F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0430 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0441\u043E\u0437\u0434\u0430\u043D\u0430")),t}catch{}},async update(e){try{(await a.update("programs",e)).error||await this.getPrograms()}catch{}},async checkAudioFree(e){return await this.getPrograms(),this.programList.filter(r=>r.audio_id===e).length===0},async checkSpinnerFree(e){return await this.getPrograms(),this.programList.filter(r=>r.spinner_id===e).length===0}}}),S=I(),A=m("spinners",{state:()=>({spinnerList:[]}),getters:{isEmpty:e=>e.spinnerList.length===0,emptySpinner:()=>({name:"",color1:"blue",color2:"red",spin1:0,spin2:1,freq1:1e3,freq2:1e3,enabled1:1,enabled2:1}),spinnersNames:e=>e.spinnerList.reduce((t,r)=>(t.push(r.name),t),[])},actions:{async getSpinners(){try{const e=await a.fetch("spinners");e.error||(this.spinnerList=e.result||[])}catch{}},getSpinnerById(e){try{return this.spinnerList.find(r=>r.id===e)}catch{}},getSpinnerByName(e){return this.spinnerList.find(t=>t.name===e)},async removeSpinner(e){if(!await L().checkSpinnerFree(e)){S.error("\u0423\u0434\u0430\u043B\u0435\u043D\u0438\u0435 \u043D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E! \u0417\u0430\u043F\u0438\u0441\u044C \u0443\u0447\u0430\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0430\u0445");return}try{const s=await a.remove("spinners",e);s.error?S.error(s.error):(await this.getSpinners(),S.success(s.result))}catch{}},async insert(e){try{const t=await a.insert("spinners",e);t.error||this.spinnerList.push({...t.result})}catch{}},async update(e){try{(await a.update("spinners",e)).error||await this.getSpinners()}catch{}}}});export{d as P,L as a,D as b,$ as c,k as d,P as e,A as u};
