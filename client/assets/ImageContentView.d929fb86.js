import{S as E,K as k,T as f,d as h,c as F,r as g,w as L,o as O,h as u,ar as U,e as p,aq as A,A as H,aj as K,_ as M,C as q,D as Q,E as S,F as w,G as P,L as G}from"./index.8c64538c.js";import{a as W,Q as x}from"./QCard.4260f523.js";import{Q as J}from"./QCardActions.5a18c38f.js";import{Q as X}from"./QDialog.4387783b.js";import{u as Y}from"./settings.store.c2c5cc80.js";const Z=E("images",{state:()=>({imagesList:[],loadingContent:!1}),getters:{placeholderUrl:()=>{const e=Y();return k(e),`${location.protocol}//${location.hostname}/images/placeholder.jpg`},images:e=>(t,n)=>{let r=[];return n===""?r=e.imagesList.filter(l=>l.category===t):r=e.imagesList.filter(l=>l.name.toLowerCase().includes(n.toLowerCase())),r}},actions:{async getImages(){try{const e=await f.fetch("images");e.error||(this.imagesList=e.result||[])}catch{}},getImageById(e){try{return this.imagesList.find(n=>n.id===e)}catch{}},async getContentById(e){this.loadingContent=!0;let t="";try{const n=await f.fetchById("images",e);n.error||(t=n.result.content)}catch{}return this.loadingContent=!1,t},async removeImage(e){try{(await f.remove("images",e)).error||await this.getImages()}catch{}},async insert(e){try{const t=await f.insert("images",e);t.error||this.imagesList.push({...t.result})}catch{}},async update(e){try{(await f.update("images",e)).error||await this.getImages()}catch{}}}}),ee={ratio:[String,Number]};function te(e,t){return h(()=>{const n=Number(e.ratio||(t!==void 0?t.value:void 0));return isNaN(n)!==!0&&n>0?{paddingBottom:`${100/n}%`}:null})}const ae=16/9;var ne=F({name:"QImg",props:{...ee,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:ae},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:t,emit:n}){const r=g(e.initialRatio),l=te(e,r);let i=null,c=!1;const o=[g(null),g(C())],s=g(0),d=g(!1),m=g(!1),T=h(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),N=h(()=>({width:e.width,height:e.height})),$=h(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),z=h(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));L(()=>I(),_);function I(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function C(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function _(a){i!==null&&(clearTimeout(i),i=null),m.value=!1,a===null?(d.value=!1,o[s.value^1].value=C()):d.value=!0,o[s.value].value=a}function R({target:a}){c!==!0&&(i!==null&&(clearTimeout(i),i=null),r.value=a.naturalHeight===0?.5:a.naturalWidth/a.naturalHeight,b(a,1))}function b(a,v){c===!0||v===1e3||(a.complete===!0?j(a):i=setTimeout(()=>{i=null,b(a,v+1)},50))}function j(a){c!==!0&&(s.value=s.value^1,o[s.value].value=null,d.value=!1,m.value=!1,n("load",a.currentSrc||a.src))}function V(a){i!==null&&(clearTimeout(i),i=null),d.value=!1,m.value=!0,o[s.value].value=null,o[s.value^1].value=C(),n("error",a)}function B(a){const v=o[a].value,y={key:"img_"+a,class:$.value,style:z.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...v};return s.value===a?(y.class+=" q-img__image--waiting",Object.assign(y,{onLoad:R,onError:V})):y.class+=" q-img__image--loaded",u("div",{class:"q-img__container absolute-full",key:"img"+a},u("img",y))}function D(){return d.value!==!0?u("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},p(t[m.value===!0?"error":"default"])):u("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},t.loading!==void 0?t.loading():e.noSpinner===!0?void 0:[u(A,{color:e.spinnerColor,size:e.spinnerSize})])}return _(I()),O(()=>{c=!0,i!==null&&(clearTimeout(i),i=null)}),()=>{const a=[];return l.value!==null&&a.push(u("div",{key:"filler",style:l.value})),m.value!==!0&&(o[0].value!==null&&a.push(B(0)),o[1].value!==null&&a.push(B(1))),a.push(u(U,{name:"q-transition--fade"},D)),u("div",{class:T.value,style:N.value,role:"img","aria-label":e.alt},a)}}});const ie=H({name:"ImageContentView",props:{isShow:{type:Boolean,default:!1},imageId:{type:Number,default:0}},setup(e,t){const n=K(()=>e.isShow),r=g(""),l=Z(),{loadingContent:i}=k(l);return L(()=>e.imageId,async()=>{e.imageId!==0&&(r.value=await l.getContentById(e.imageId))}),{showContent:n,content:r,loadingContent:i,close:()=>{t.emit("close")}}}});function re(e,t,n,r,l,i){return q(),Q(X,{modelValue:e.showContent,"onUpdate:modelValue":t[0]||(t[0]=c=>e.showContent=c),persistent:""},{default:S(()=>[w(x,null,{default:S(()=>[e.loadingContent?P("",!0):(q(),Q(W,{key:0,class:"flex justify-center items-center"},{default:S(()=>[w(ne,{src:e.content,"spinner-color":"white",style:{width:"300px"}},null,8,["src"])]),_:1})),w(J,{align:"right"},{default:S(()=>[w(G,{flat:"",label:"OK",color:"primary",onClick:e.close},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var ge=M(ie,[["render",re]]);export{ge as I,ne as Q,Z as u};
