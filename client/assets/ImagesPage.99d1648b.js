import{c as W,r as f,d as r,h as c,ak as G,j as ee,y as te,w as ae,f as le,ao as ie,e as ne,an as ue,a1 as se,a2 as A,_ as oe,K as re,V as ce,M as C,N as D,O as w,X as _,P as F,S as E,D as de,ar as me,Q as fe,ah as ge,W as M,Y as L,$ as ve,Z as he,T as ye}from"./index.df45ce35.js";import{Q as be}from"./QChip.10758128.js";import{u as Se,a as pe,b as we,c as Ce,d as _e,e as Fe,f as K,g as Ve,Q as Ie}from"./QInput.9a2891d3.js";import{u as xe,a as ke,b as qe}from"./use-file.cdb3e4fd.js";import{h as je}from"./format.2a3572e1.js";import{Q as Ne}from"./QCardActions.f8745468.js";import{Q as Qe}from"./QCard.caf86de4.js";import{Q as Be}from"./QPage.7452c4bc.js";import{u as Te}from"./message.store.4bd0f97a.js";import"./use-dark.d615d576.js";import"./focus-manager.05708ea9.js";import"./use-quasar.122cfa9e.js";var Le=W({name:"QFile",inheritAttrs:!1,props:{...Se,...pe,...xe,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...we,...ke],setup(e,{slots:a,emit:s,attrs:o}){const{proxy:h}=ee(),l=Ce(),n=f(null),d=f(!1),g=_e(e),{pickFiles:b,onDragover:S,onDragleave:q,processFiles:j,getDndNode:v}=qe({editable:l.editable,dnd:d,getFileInput:O,addFilesToQueue:U}),P=Fe(e),u=r(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),V=r(()=>K(u.value)),N=r(()=>u.value.map(t=>t.name).join(", ")),Q=r(()=>je(u.value.reduce((t,m)=>t+m.size,0))),B=r(()=>({totalSize:Q.value,filesNumber:u.value.length,maxFiles:e.maxFiles})),R=r(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:g.value,...o,id:l.targetUid.value,disabled:l.editable.value!==!0})),z=r(()=>"q-file q-field--auto-height"+(d.value===!0?" q-file--dnd":"")),x=r(()=>e.multiple===!0&&e.append===!0);function k(t){const m=u.value.slice();m.splice(t,1),p(m)}function i(t){const m=u.value.indexOf(t);m>-1&&k(m)}function p(t){s("update:modelValue",e.multiple===!0?t:t[0])}function I(t){t.keyCode===13&&te(t)}function J(t){(t.keyCode===13||t.keyCode===32)&&b(t)}function O(){return n.value}function U(t,m){const y=j(t,m,u.value,x.value),$=O();$!=null&&($.value=""),y!==void 0&&((e.multiple===!0?e.modelValue&&y.every(Z=>u.value.includes(Z)):e.modelValue===y[0])||p(x.value===!0?u.value.concat(y):y))}function T(){return[c("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function X(){if(a.file!==void 0)return u.value.length===0?T():u.value.map((m,y)=>a.file({index:y,file:m,ref:this}));if(a.selected!==void 0)return u.value.length===0?T():a.selected({files:u.value,ref:this});if(e.useChips===!0)return u.value.length===0?T():u.value.map((m,y)=>c(be,{key:"file-"+y,removable:l.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{k(y)}},()=>c("span",{class:"ellipsis",textContent:m.name})));const t=e.displayValue!==void 0?e.displayValue:N.value;return t.length!==0?[c("div",{class:e.inputClass,style:e.inputStyle,textContent:t})]:T()}function Y(){const t={ref:n,...R.value,...P.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:U};return e.multiple===!0&&(t.multiple=!0),c("input",t)}return Object.assign(l,{fieldClass:z,emitValue:p,hasValue:V,inputRef:n,innerValue:u,floatingLabel:r(()=>V.value===!0||K(e.displayValue)),computedCounter:r(()=>{if(e.counterLabel!==void 0)return e.counterLabel(B.value);const t=e.maxFiles;return`${u.value.length}${t!==void 0?" / "+t:""} (${Q.value})`}),getControlChild:()=>v("file"),getControl:()=>{const t={ref:l.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return l.editable.value===!0&&Object.assign(t,{onDragover:S,onDragleave:q,onKeydown:I,onKeyup:J}),c("div",t,[Y()].concat(X()))}}),Object.assign(h,{removeAtIndex:k,removeFile:i,getNativeElement:()=>n.value}),G(h,"nativeEl",()=>n.value),Ve(l)}});const Pe={ratio:[String,Number]};function Re(e,a){return r(()=>{const s=Number(e.ratio||(a!==void 0?a.value:void 0));return isNaN(s)!==!0&&s>0?{paddingBottom:`${100/s}%`}:null})}const ze=16/9;var H=W({name:"QImg",props:{...Pe,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:ze},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:a,emit:s}){const o=f(e.initialRatio),h=Re(e,o);let l=null,n=!1;const d=[f(null),f(V())],g=f(0),b=f(!1),S=f(!1),q=r(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),j=r(()=>({width:e.width,height:e.height})),v=r(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),P=r(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));ae(()=>u(),N);function u(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function V(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function N(i){l!==null&&(clearTimeout(l),l=null),S.value=!1,i===null?(b.value=!1,d[g.value^1].value=V()):b.value=!0,d[g.value].value=i}function Q({target:i}){n!==!0&&(l!==null&&(clearTimeout(l),l=null),o.value=i.naturalHeight===0?.5:i.naturalWidth/i.naturalHeight,B(i,1))}function B(i,p){n===!0||p===1e3||(i.complete===!0?R(i):l=setTimeout(()=>{l=null,B(i,p+1)},50))}function R(i){n!==!0&&(g.value=g.value^1,d[g.value].value=null,b.value=!1,S.value=!1,s("load",i.currentSrc||i.src))}function z(i){l!==null&&(clearTimeout(l),l=null),b.value=!1,S.value=!0,d[g.value].value=null,d[g.value^1].value=V(),s("error",i)}function x(i){const p=d[i].value,I={key:"img_"+i,class:v.value,style:P.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...p};return g.value===i?(I.class+=" q-img__image--waiting",Object.assign(I,{onLoad:Q,onError:z})):I.class+=" q-img__image--loaded",c("div",{class:"q-img__container absolute-full",key:"img"+i},c("img",I))}function k(){return b.value!==!0?c("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},ne(a[S.value===!0?"error":"default"])):c("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},a.loading!==void 0?a.loading():e.noSpinner===!0?void 0:[c(ue,{color:e.spinnerColor,size:e.spinnerSize})])}return N(u()),le(()=>{n=!0,l!==null&&(clearTimeout(l),l=null)}),()=>{const i=[];return h.value!==null&&i.push(c("div",{key:"filler",style:h.value})),S.value!==!0&&(d[0].value!==null&&i.push(x(0)),d[1].value!==null&&i.push(x(1))),i.push(c(ie,{name:"q-transition--fade"},k)),c("div",{class:q.value,style:j.value,role:"img","aria-label":e.alt},i)}}});const $e=se("images",{state:()=>({imagesList:[]}),getters:{},actions:{async getImages(){try{const e=await A.fetch("images");e.error||(this.imagesList=e.result||[])}catch{}},async removeImage(e){try{(await A.remove("images",e)).error||await this.getImages()}catch{}},async insert(e){try{const a=await A.insert("images",e);a.error||this.imagesList.push({...a.result})}catch{}}}}),Ae=re({name:"ImagesPage",setup(){const e=f(!1),a=f(-1),s=f(null),o=f(""),h=f(""),l=$e(),{imagesList:n}=ce(l),d=Te();return l.getImages(),{imagesList:n,confirm:e,image:s,imageUrl:o,name:h,failed:async v=>{d.error(JSON.parse(v.xhr.responseText).message)},confirmRemove:v=>{a.value=v,e.value=!0},removeImage:async()=>{await l.removeImage(a.value)},handleUpload:async()=>{if(s.value){const v=await De(s.value);o.value=v}},save:async()=>{if(s.value){const v={record:{name:h.value,content:o.value},fileName:s.value.name};await l.insert(v),h.value=""}}}}}),De=e=>new Promise(function(a,s){if(!(e instanceof Blob))return s("bufferToImage - expected buf to be of type: Blob");var o=new FileReader;o.onload=function(){return typeof o.result!="string"?s("bufferToImage - expected reader.result to be a string, in onload"):a(o.result)},o.onerror=s,o.readAsDataURL(e)}),Ee={class:"row justify-between items-start full-width"},Oe={class:"row justify-start q-pa-md full-width q-col-gutter-md"},Ue={class:"col-md-6 col-12"},Me={class:"col-md-6 col-12 flex justify-center"},Ke={key:0,width:"300",src:"http://localhost:8880/images/placeholder.jpg"},He={class:"flex justify-center q-px-md"},We={key:0},Je={key:1,class:"full-width flex justify-start wrap"},Xe={class:"absolute-bottom"},Ye={style:{"font-size":"12px"}};function Ze(e,a,s,o,h,l){return C(),D(Be,null,{default:w(()=>[_("div",Ee,[_("section",Oe,[_("div",Ue,[F(Le,{class:"full-width",outlined:"","bottom-slots":"",modelValue:e.image,"onUpdate:modelValue":[a[1]||(a[1]=n=>e.image=n),e.handleUpload],counter:"","max-files":"1",label:"\u0412\u044B\u0431\u043E\u0440 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F",accept:".jpg, .jpeg, .png"},{hint:w(()=>[E(" \u0420\u0430\u0437\u043C\u0435\u0440 ")]),append:w(()=>[de(F(fe,{name:"close",onClick:a[0]||(a[0]=ge(n=>e.image=null,["stop","prevent"])),class:"cursor-pointer"},null,512),[[me,e.image!==null]])]),_:1},8,["modelValue","onUpdate:modelValue"]),F(Ie,{outlined:"",class:"q-my-md",label:"\u0418\u043C\u044F",modelValue:e.name,"onUpdate:modelValue":a[2]||(a[2]=n=>e.name=n)},null,8,["modelValue"]),F(M,{onClick:e.save,color:"primary",rounded:"",disable:e.image===null||e.name===""},{default:w(()=>[E("\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u0431\u0430\u0437\u0443")]),_:1},8,["onClick","disable"])]),_("div",Me,[e.image?(C(),D(H,{key:1,src:e.imageUrl,"spinner-color":"white",style:{height:"300px","max-width":"300px"},fit:"cover"},null,8,["src"])):(C(),L("img",Ke))])]),_("section",He,[e.imagesList.length===0?(C(),L("h6",We,"\u0421\u043F\u0438\u0441\u043E\u043A \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0439 \u043F\u0443\u0441\u0442")):(C(),L("div",Je,[(C(!0),L(ve,null,he(e.imagesList,n=>(C(),D(Qe,{key:n.id,class:"q-ma-sm",style:{width:"200px"}},{default:w(()=>[F(H,{src:n.content,style:{height:"200px","max-width":"200px"}},{default:w(()=>[_("div",Xe,[_("div",Ye,ye(n.name),1)])]),_:2},1032,["src"]),F(Ne,null,{default:w(()=>[F(M,{flat:""},{default:w(()=>[E("\u0423\u0434\u0430\u043B\u0438\u0442\u044C")]),_:1})]),_:1})]),_:2},1024))),128))]))])])]),_:1})}var dt=oe(Ae,[["render",Ze]]);export{dt as default};
