import{c as ue,r as c,d as C,h as I,an as ie,j as re,a7 as de,A as N,K as D,aj as J,w as me,_ as L,C as S,N as k,F as l,E as g,M as m,L as V,I as G,B as Q,R as ce,ay as fe,az as ge,D as x,H as K,m as pe,aF as ve,Q as ye,ak as he}from"./index.e98fe3e5.js";import{c as Ce,a as we}from"./QCheckbox.b1039a88.js";import{d as be,u as Se,e as _e,g as Ie,h as Ve,k as Fe,i as M,f as $e,Q as U}from"./QInput.4a69d35c.js";import{u as ke,a as De,b as qe}from"./use-file.4377b425.js";import{h as Qe}from"./format.3748299a.js";import{u as W,I as Be,Q as je}from"./ImageContentView.20fe030a.js";import{Q as Ae}from"./QPage.eb809f1d.js";import{j as X}from"./message.store.86c71126.js";import{u as P}from"./image-categories.store.abb5a48e.js";import{Q as Ee}from"./QVirtualScroll.a563219f.js";import{Q as Ne,a as Le}from"./QCard.e1fad818.js";import{Q as Ue}from"./QDialog.34a82b16.js";import{Q as H,a as Pe}from"./QTable.ec821897.js";import{C as Oe}from"./ConfirmDialog.73312f50.js";import"./use-dark.beab2589.js";import"./QItem.685ddbb8.js";import"./position-engine.17c831e0.js";import"./focus-manager.05708ea9.js";import"./use-virtual-scroll.d24b247d.js";import"./QCardActions.686d4fad.js";import"./settings.store.82a58d89.js";import"./use-quasar.6bf1d505.js";import"./QList.383f5d45.js";import"./QSeparator.dde7d7bd.js";var Te=ue({name:"QFile",inheritAttrs:!1,props:{...be,...Se,...ke,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[..._e,...De],setup(e,{slots:t,emit:r,attrs:d}){const{proxy:p}=re(),n=Ie(),a=c(null),s=c(!1),v=Ve(e),{pickFiles:u,onDragover:b,onDragleave:F,processFiles:$,getDndNode:_}=qe({editable:n.editable,dnd:s,getFileInput:R,addFilesToQueue:z}),B=Fe(e),i=C(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),w=C(()=>M(i.value)),O=C(()=>i.value.map(o=>o.name).join(", ")),y=C(()=>Qe(i.value.reduce((o,f)=>o+f.size,0))),Y=C(()=>({totalSize:y.value,filesNumber:i.value.length,maxFiles:e.maxFiles})),Z=C(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:v.value,...d,id:n.targetUid.value,disabled:n.editable.value!==!0})),ee=C(()=>"q-file q-field--auto-height"+(s.value===!0?" q-file--dnd":"")),T=C(()=>e.multiple===!0&&e.append===!0);function j(o){const f=i.value.slice();f.splice(o,1),A(f)}function te(o){const f=i.value.indexOf(o);f>-1&&j(f)}function A(o){r("update:modelValue",e.multiple===!0?o:o[0])}function oe(o){o.keyCode===13&&de(o)}function ae(o){(o.keyCode===13||o.keyCode===32)&&u(o)}function R(){return a.value}function z(o,f){const h=$(o,f,i.value,T.value),E=R();E!=null&&(E.value=""),h!==void 0&&((e.multiple===!0?e.modelValue&&h.every(ne=>i.value.includes(ne)):e.modelValue===h[0])||A(T.value===!0?i.value.concat(h):h))}function q(){return[I("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function le(){if(t.file!==void 0)return i.value.length===0?q():i.value.map((f,h)=>t.file({index:h,file:f,ref:this}));if(t.selected!==void 0)return i.value.length===0?q():t.selected({files:i.value,ref:this});if(e.useChips===!0)return i.value.length===0?q():i.value.map((f,h)=>I(Ce,{key:"file-"+h,removable:n.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{j(h)}},()=>I("span",{class:"ellipsis",textContent:f.name})));const o=e.displayValue!==void 0?e.displayValue:O.value;return o.length!==0?[I("div",{class:e.inputClass,style:e.inputStyle,textContent:o})]:q()}function se(){const o={ref:a,...Z.value,...B.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:z};return e.multiple===!0&&(o.multiple=!0),I("input",o)}return Object.assign(n,{fieldClass:ee,emitValue:A,hasValue:w,inputRef:a,innerValue:i,floatingLabel:C(()=>w.value===!0||M(e.displayValue)),computedCounter:C(()=>{if(e.counterLabel!==void 0)return e.counterLabel(Y.value);const o=e.maxFiles;return`${i.value.length}${o!==void 0?" / "+o:""} (${y.value})`}),getControlChild:()=>_("file"),getControl:()=>{const o={ref:n.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return n.editable.value===!0&&Object.assign(o,{onDragover:b,onDragleave:F,onKeydown:oe,onKeyup:ae}),I("div",o,[se()].concat(le()))}}),Object.assign(p,{removeAtIndex:j,removeFile:te,getNativeElement:()=>a.value}),ie(p,"nativeEl",()=>a.value),$e(n)}});const Re=N({name:"ImageCategoryAdd",props:{isShow:{type:Boolean,default:!1}},setup(e,t){const r=P(),d=X(),{categoriesList:p}=D(r),n=J(()=>e.isShow),a=c("");return me(n,u=>{u&&(a.value="")}),{categoriesList:p,show:n,name:a,close:()=>{t.emit("close")},save:async()=>{if(a.value===""){d.error("\u0418\u043C\u044F \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438 \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u043F\u0443\u0441\u0442\u044B\u043C!");return}const u=await r.insert({record:{name:a.value}});console.log(u)}}}}),ze={class:"q-pa-md q-gutter-sm"},xe={class:"flex justify-between items-center"},Ke={class:"q-mt-sm q-pa-sm item",dense:"",clickable:""},Me={class:"flex justify-between items-center"},He={class:"flex justify-center items-center q-ma-md"};function Je(e,t,r,d,p,n){return S(),k("div",ze,[l(Ue,{modelValue:e.show,"onUpdate:modelValue":t[1]||(t[1]=a=>e.show=a),persistent:""},{default:g(()=>[l(Ne,null,{default:g(()=>[l(Le,null,{default:g(()=>[m("div",xe,[l(U,{outlined:"",autofocus:"",label:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E",modelValue:e.name,"onUpdate:modelValue":t[0]||(t[0]=a=>e.name=a),style:{padding:"0"}},null,8,["modelValue"]),l(V,{class:"q-ml-md",round:"",color:"primary",label:">",onClick:e.save},null,8,["onClick"])]),l(Ee,{style:{height:"300px"},class:"q-px-md",items:e.categoriesList,separator:""},{default:g(({item:a})=>[m("div",Ke,[m("div",Me,[m("div",null,G(a.name),1)])])]),_:1},8,["items"])]),_:1}),m("div",He,[l(V,{label:"\u041E\u0442\u043C\u0435\u043D\u0430",color:"primary",onClick:e.close},null,8,["onClick"])])]),_:1})]),_:1},8,["modelValue"])])}var Ge=L(Re,[["render",Je],["__scopeId","data-v-18db3cbb"]]);const We=[{name:"name",required:!0,label:"\u0418\u043C\u044F",align:"left",field:e=>e.name,format:e=>`${e}`,sortable:!1},{name:"category",required:!0,label:"\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F",align:"left",field:e=>e.category,format:e=>`${e}`,sortable:!1},{name:"descriptor",required:!0,label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",align:"right",field:e=>e.descriptor,format:e=>`${e}`,sortable:!1}],Xe=N({name:"ImagesList",components:{ConfirmDialog:Oe},props:{category:{type:String,default:()=>""},showControls:{type:Boolean,default:!0},showCategory:{type:Boolean,default:!0}},emits:{showContent:null},setup(e,t){const r=W(),d=P(),{categoryNames:p}=D(d),n=J(()=>e.category),a=c(!1),s=c(""),v=c(1),{images:u}=D(r),b=c(0),F=w=>{b.value=w,a.value=!0},$=async()=>{await r.removeImage(b.value),_()},_=()=>{a.value=!1,b.value=0};return{isShowDialog:a,categoryNames:p,curCategory:n,images:u,searchByName:s,current:v,columns:We,confirmDelete:F,removeImage:$,closeDialog:_,update:async w=>{console.log(w)},showContent:w=>{t.emit("showContent",w)}}}}),Ye=e=>(fe("data-v-45565c69"),e=e(),ge(),e),Ze=Ye(()=>m("div",{class:"flex items-center q-mb-sm"},null,-1)),et={class:"full-width"},tt={class:"row items-center item-control"},ot={style:{color:"black"}},at={class:"row justify-end"},lt={class:"flex justify-end item-control"},st={class:"q-gutter-xs"};function nt(e,t,r,d,p,n){const a=Q("ConfirmDialog");return S(),k(ce,null,[Ze,m("div",et,[l(Pe,{flat:"",bordered:"","virtual-scroll":"",rows:e.images(e.curCategory,e.searchByName),columns:e.columns,"row-key":"name","rows-per-page-options":[7,10,15,20,25,50,0]},{"body-cell-name":g(s=>[l(H,{props:s},{default:g(()=>[m("div",tt,[l(V,{class:"q-mr-md",size:"12px",flat:"",dense:"",round:"",icon:"person",onClick:v=>e.showContent(s.row.id)},null,8,["onClick"]),m("em",ot,G(s.row.name),1)])]),_:2},1032,["props"])]),"body-cell-descriptor":g(s=>[l(H,{props:s},{default:g(()=>[m("div",at,[m("div",lt,[m("div",st,[l(V,{class:"q-mr-sm",size:"12px",flat:"",dense:"",round:"",icon:"delete",onClick:v=>e.confirmDelete(s.row.id)},null,8,["onClick"])])])])]),_:2},1032,["props"])]),"top-left":g(()=>[l(U,{debounce:"300",outlined:"",modelValue:e.searchByName,"onUpdate:modelValue":t[0]||(t[0]=s=>e.searchByName=s),label:"\u041F\u043E\u0438\u0441\u043A \u043F\u043E \u0438\u043C\u0435\u043D\u0438"},null,8,["modelValue"])]),_:1},8,["rows","columns"])]),l(a,{isShow:e.isShowDialog,message:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u0443\u044E \u0437\u0430\u043F\u0438\u0441\u044C?",onOk:e.removeImage,onCancel:e.closeDialog},null,8,["isShow","onOk","onCancel"])],64)}var ut=L(Xe,[["render",nt],["__scopeId","data-v-45565c69"]]);const it=N({name:"ImagesPage",components:{ImageCategoryAdd:Ge,ImagesList:ut,ImageContentView:Be},setup(){const e=c(null),t=c(""),r=c(""),d=c(""),p=c(!1),n=c(!1),a=c(0),s=W(),v=P(),{defaultCategory:u,categoryNames:b}=D(v);d.value=u.value.name;const{imagesList:F,placeholderUrl:$}=D(s),_=X();return s.getImages(),{imagesList:F,image:e,imageUrl:t,name:r,isShowDialog:p,isShowContent:n,placeholderUrl:$,category:d,categoryNames:b,showContentId:a,failed:async y=>{_.error(JSON.parse(y.xhr.responseText).message)},handleUpload:async()=>{if(e.value){const y=await rt(e.value);t.value=y}},save:async()=>{if(e.value){const y={record:{name:r.value,content:t.value,category:d.value},fileName:e.value.name};await s.insert(y),r.value=""}},showContent:y=>{a.value=y,n.value=!0}}}}),rt=e=>new Promise(function(t,r){if(!(e instanceof Blob))return r("bufferToImage - expected buf to be of type: Blob");var d=new FileReader;d.onload=function(){return typeof d.result!="string"?r("bufferToImage - expected reader.result to be a string, in onload"):t(d.result)},d.onerror=r,d.readAsDataURL(e)}),dt={class:"row justify-between items-start full-width"},mt={class:"row justify-start q-pa-md full-width q-col-gutter-md"},ct={class:"col-md-6 col-12"},ft={class:"flex justify-between items-center"},gt={class:"col-md-6 col-12 flex justify-center"},pt=["src"],vt={class:"full-width flex justify-center q-px-lg"},yt={key:0},ht={key:1,class:"full-width flex justify-start wrap"};function Ct(e,t,r,d,p,n){const a=Q("ImagesList"),s=Q("ImageCategoryAdd"),v=Q("ImageContentView");return S(),x(Ae,null,{default:g(()=>[m("div",dt,[m("section",mt,[m("div",ct,[l(Te,{class:"full-width",outlined:"","bottom-slots":"",modelValue:e.image,"onUpdate:modelValue":[t[1]||(t[1]=u=>e.image=u),e.handleUpload],counter:"","max-files":"1",label:"\u0412\u044B\u0431\u043E\u0440 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F",accept:".jpg, .jpeg, .png"},{hint:g(()=>[K(" \u0420\u0430\u0437\u043C\u0435\u0440 ")]),append:g(()=>[pe(l(ye,{name:"close",onClick:t[0]||(t[0]=he(u=>e.image=null,["stop","prevent"])),class:"cursor-pointer"},null,512),[[ve,e.image!==null]])]),_:1},8,["modelValue","onUpdate:modelValue"]),l(U,{outlined:"",class:"q-my-md",label:"\u0418\u043C\u044F",modelValue:e.name,"onUpdate:modelValue":t[2]||(t[2]=u=>e.name=u),style:{padding:"0"}},null,8,["modelValue"]),m("div",ft,[l(we,{style:{width:"85%",padding:"0"},"bottom-slots":"",modelValue:e.category,"onUpdate:modelValue":t[3]||(t[3]=u=>e.category=u),options:e.categoryNames,label:"\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F",outlined:""},null,8,["modelValue","options"]),l(V,{round:"",color:"primary",icon:"add",onClick:t[4]||(t[4]=u=>e.isShowDialog=!0)})]),l(V,{onClick:e.save,class:"q-mt-md",color:"primary",rounded:"",disable:e.image===null||e.name===""},{default:g(()=>[K("\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u0431\u0430\u0437\u0443")]),_:1},8,["onClick","disable"])]),m("div",gt,[e.image?(S(),x(je,{key:1,src:e.imageUrl,"spinner-color":"white",style:{height:"300px","max-width":"300px"},fit:"cover"},null,8,["src"])):(S(),k("img",{key:0,width:"250",src:e.placeholderUrl},null,8,pt))])]),m("section",vt,[e.imagesList.length===0?(S(),k("h6",yt,"\u0421\u043F\u0438\u0441\u043E\u043A \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0439 \u043F\u0443\u0441\u0442")):(S(),k("div",ht,[l(a,{category:e.category,onShowContent:e.showContent},null,8,["category","onShowContent"])]))])]),l(s,{isShow:e.isShowDialog,onClose:t[5]||(t[5]=u=>e.isShowDialog=!1)},null,8,["isShow"]),l(v,{isShow:e.isShowContent,imageId:e.showContentId,onClose:t[6]||(t[6]=u=>e.isShowContent=!1)},null,8,["isShow","imageId"])]),_:1})}var xt=L(it,[["render",Ct]]);export{xt as default};
